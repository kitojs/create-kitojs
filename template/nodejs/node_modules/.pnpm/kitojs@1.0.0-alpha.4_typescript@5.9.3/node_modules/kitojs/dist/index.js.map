{"version":3,"file":"index.js","names":["item: T","shape: any","schema","value: T","schemas: T","HTTP_STATUS_MESSAGES: Record<number, string>","responseCall: ResponseCall | null","newResponseCall: ResponseCall","obj: any","arr: any[]","middleware","chain: RouteChain<TExtensions>","finalHandler: RouteHandler<TSchema, TExtensions>","middlewares: (MiddlewareDefinition | TSchema)[]","routeMiddlewares: MiddlewareDefinition[]","routeSchema: TSchema | undefined","staticResponse: StaticResponseType","context: any","serialized: any","schema","port: number | undefined","host: string | undefined","ready: (() => void) | undefined","configuration: ServerOptionsCore"],"sources":["../src/schemas/primitives/string.ts","../src/schemas/primitives/number.ts","../src/schemas/primitives/boolean.ts","../src/schemas/primitives/array.ts","../src/schemas/primitives/object.ts","../src/schemas/primitives/literal.ts","../src/schemas/primitives/union.ts","../src/schemas/builders.ts","../src/helpers/schema.ts","../src/helpers/middleware.ts","../src/server/request.ts","../src/server/response.ts","../src/server/analyzer.ts","../src/server/server.ts"],"sourcesContent":["import type { StringSchema } from \"@kitojs/types\";\n\nexport class StringSchemaImpl implements StringSchema {\n  _type!: string;\n  _optional = false;\n  _default: unknown = undefined;\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private constraints: any[] = [];\n\n  min(length: number): StringSchema {\n    this.constraints.push({ type: \"min\", value: length });\n    return this;\n  }\n\n  max(length: number): StringSchema {\n    this.constraints.push({ type: \"max\", value: length });\n    return this;\n  }\n\n  length(length: number): StringSchema {\n    this.constraints.push({ type: \"length\", value: length });\n    return this;\n  }\n\n  email(): StringSchema {\n    this.constraints.push({ type: \"email\" });\n    return this;\n  }\n\n  url(): StringSchema {\n    this.constraints.push({ type: \"url\" });\n    return this;\n  }\n\n  uuid(): StringSchema {\n    this.constraints.push({ type: \"uuid\" });\n    return this;\n  }\n\n  regex(pattern: RegExp): StringSchema {\n    this.constraints.push({ type: \"regex\", value: pattern });\n    return this;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: string): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    return {\n      type: \"string\",\n      optional: this._optional,\n      default: this._default,\n      constraints: this.constraints,\n    };\n  }\n}\n","import type { NumberSchema } from \"@kitojs/types\";\n\nexport class NumberSchemaImpl implements NumberSchema {\n  _type!: number;\n  _optional = false;\n  _default: unknown = undefined;\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private constraints: any[] = [];\n\n  min(value: number): NumberSchema {\n    this.constraints.push({ type: \"min\", value });\n    return this;\n  }\n\n  max(value: number): NumberSchema {\n    this.constraints.push({ type: \"max\", value });\n    return this;\n  }\n\n  int(): NumberSchema {\n    this.constraints.push({ type: \"int\" });\n    return this;\n  }\n\n  positive(): NumberSchema {\n    this.constraints.push({ type: \"positive\" });\n    return this;\n  }\n\n  negative(): NumberSchema {\n    this.constraints.push({ type: \"negative\" });\n    return this;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: number): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    return {\n      type: \"number\",\n      optional: this._optional,\n      default: this._default,\n      constraints: this.constraints,\n    };\n  }\n}\n","import type { BooleanSchema } from \"@kitojs/types\";\n\nexport class BooleanSchemaImpl implements BooleanSchema {\n  _type!: boolean;\n  _optional = false;\n  _default: unknown = undefined;\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: boolean): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    return {\n      type: \"boolean\",\n      optional: this._optional,\n      default: this._default,\n    };\n  }\n}\n","import type { ArraySchema, SchemaType } from \"@kitojs/types\";\n\nexport class ArraySchemaImpl<T extends SchemaType> implements ArraySchema<T> {\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  _type!: any[];\n  _optional = false;\n  _default: unknown = undefined;\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private constraints: any[] = [];\n\n  constructor(private item: T) {}\n\n  min(length: number): ArraySchema<T> {\n    this.constraints.push({ type: \"min\", value: length });\n    return this;\n  }\n\n  max(length: number): ArraySchema<T> {\n    this.constraints.push({ type: \"max\", value: length });\n    return this;\n  }\n\n  length(length: number): ArraySchema<T> {\n    this.constraints.push({ type: \"length\", value: length });\n    return this;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: any[]): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    return {\n      type: \"array\",\n      optional: this._optional,\n      default: this._default,\n      constraints: this.constraints,\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      item: (this.item as any)._serialize(),\n    };\n  }\n}\n","import type { InferType, ObjectSchema, SchemaType } from \"@kitojs/types\";\n\nexport class ObjectSchemaImpl<T extends Record<string, SchemaType>>\n  implements ObjectSchema<T>\n{\n  _type!: { [K in keyof T]: InferType<T[K]> };\n  _optional = false;\n  _default: unknown = undefined;\n  shape: T;\n\n  constructor(shape: T) {\n    this.shape = shape;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: any): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    // biome-ignore lint/suspicious/noExplicitAny: ...\n    const shape: any = {};\n    for (const [key, schema] of Object.entries(this.shape)) {\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      shape[key] = (schema as any)._serialize();\n    }\n    return {\n      type: \"object\",\n      optional: this._optional,\n      default: this._default,\n      shape,\n    };\n  }\n}\n","import type { LiteralSchema } from \"@kitojs/types\";\n\nexport class LiteralSchemaImpl<T extends string | number | boolean>\n  implements LiteralSchema<T>\n{\n  _type!: T;\n  _optional = false;\n  _default: unknown = undefined;\n\n  constructor(private value: T) {}\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: T): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    return {\n      type: \"literal\",\n      optional: this._optional,\n      default: this._default,\n      value: this.value,\n    };\n  }\n}\n","import type { SchemaType, UnionSchema } from \"@kitojs/types\";\n\nexport class UnionSchemaImpl<T extends SchemaType[]> implements UnionSchema<T> {\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  _type!: any;\n  _optional = false;\n  _default: unknown = undefined;\n\n  constructor(private schemas: T) {}\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  optional(): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    return clone;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  default(value: any): any {\n    const clone = Object.assign(\n      Object.create(Object.getPrototypeOf(this)),\n      this,\n    );\n    clone._optional = true;\n    clone._default = value;\n    return clone;\n  }\n\n  _serialize() {\n    return {\n      type: \"union\",\n      optional: this._optional,\n      default: this._default,\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      schemas: this.schemas.map((s) => (s as any)._serialize()),\n    };\n  }\n}\n","// biome-ignore assist/source/organizeImports: ...\nimport { StringSchemaImpl } from \"./primitives/string\";\nimport { NumberSchemaImpl } from \"./primitives/number\";\nimport { BooleanSchemaImpl } from \"./primitives/boolean\";\nimport { ArraySchemaImpl } from \"./primitives/array\";\nimport { ObjectSchemaImpl } from \"./primitives/object\";\nimport { LiteralSchemaImpl } from \"./primitives/literal\";\nimport { UnionSchemaImpl } from \"./primitives/union\";\n\nimport type {\n  StringSchema,\n  NumberSchema,\n  BooleanSchema,\n  ArraySchema,\n  ObjectSchema,\n  LiteralSchema,\n  UnionSchema,\n  SchemaType,\n} from \"@kitojs/types\";\n\n/**\n * Schema builder utilities for creating type-safe request validation schemas.\n *\n * @example\n * ```typescript\n * import { t, schema } from 'kitojs';\n *\n * const userSchema = schema({\n *   params: t.object({\n *     id: t.str().uuid()\n *   }),\n *   body: t.object({\n *     name: t.str().min(1).max(50),\n *     email: t.str().email(),\n *     age: t.num().min(0).optional()\n *   })\n * });\n *\n * app.post('/users/:id', [userSchema], ctx => {\n *   // ctx.req.params.id is validated as UUID\n *   // ctx.req.body is type-safe and validated\n * });\n * ```\n */\nexport const t = {\n  /**\n   * Creates a string schema builder.\n   *\n   * @returns String schema with validation methods\n   *\n   * @example\n   * ```typescript\n   * t.str() // basic string\n   * t.str().min(3).max(50) // length constraints\n   * t.str().email() // email validation\n   * t.str().uuid() // UUID validation\n   * t.str().optional() // optional field\n   * t.str().default('hello') // default value\n   * ```\n   */\n  str(): StringSchema {\n    return new StringSchemaImpl();\n  },\n\n  /**\n   * Creates a number schema builder.\n   *\n   * @returns Number schema with validation methods\n   *\n   * @example\n   * ```typescript\n   * t.num() // basic number\n   * t.num().min(0).max(100) // range constraints\n   * t.num().int() // integer only\n   * t.num().positive() // positive numbers\n   * t.num().optional() // optional field\n   * t.num().default(0) // default value\n   * ```\n   */\n  num(): NumberSchema {\n    return new NumberSchemaImpl();\n  },\n\n  /**\n   * Creates a boolean schema builder.\n   *\n   * @returns Boolean schema with validation methods\n   *\n   * @example\n   * ```typescript\n   * t.bool() // basic boolean\n   * t.bool().optional() // optional field\n   * t.bool().default(false) // default value\n   * ```\n   */\n  bool(): BooleanSchema {\n    return new BooleanSchemaImpl();\n  },\n\n  /**\n   * Creates an array schema builder.\n   *\n   * @template T - Type of array items\n   * @param item - Schema for array items\n   * @returns Array schema with validation methods\n   *\n   * @example\n   * ```typescript\n   * t.array(t.str()) // string array\n   * t.array(t.num().positive()) // array of positive numbers\n   * t.array(t.object({ name: t.str() })) // array of objects\n   * t.array(t.str()).min(1).max(10) // length constraints\n   * ```\n   */\n  array<T extends SchemaType>(item: T): ArraySchema<T> {\n    return new ArraySchemaImpl(item);\n  },\n\n  /**\n   * Creates an object schema builder.\n   *\n   * @template T - Object shape definition\n   * @param shape - Object property schemas\n   * @returns Object schema with validation methods\n   *\n   * @example\n   * ```typescript\n   * t.object({\n   *   name: t.str(),\n   *   age: t.num(),\n   *   email: t.str().email().optional()\n   * })\n   *\n   * // Nested objects\n   * t.object({\n   *   user: t.object({\n   *     profile: t.object({\n   *       bio: t.str()\n   *     })\n   *   })\n   * })\n   * ```\n   */\n  object<T extends Record<string, SchemaType>>(shape: T): ObjectSchema<T> {\n    return new ObjectSchemaImpl(shape);\n  },\n\n  /**\n   * Creates a literal schema for exact value matching.\n   *\n   * @template T - Literal value type\n   * @param value - Exact value to match\n   * @returns Literal schema\n   *\n   * @example\n   * ```typescript\n   * t.literal('admin') // matches only \"admin\"\n   * t.literal(42) // matches only 42\n   * t.literal(true) // matches only true\n   * ```\n   */\n  literal<T extends string | number | boolean>(value: T): LiteralSchema<T> {\n    return new LiteralSchemaImpl(value);\n  },\n\n  /**\n   * Creates a union schema for multiple possible types.\n   *\n   * @template T - Array of possible schema types\n   * @param schemas - Schemas to union\n   * @returns Union schema\n   *\n   * @example\n   * ```typescript\n   * // String or number\n   * t.union(t.str(), t.num())\n   *\n   * // Enum-like literals\n   * t.union(\n   *   t.literal('admin'),\n   *   t.literal('user'),\n   *   t.literal('guest')\n   * )\n   *\n   * // Complex types\n   * t.union(\n   *   t.object({ type: t.literal('user'), name: t.str() }),\n   *   t.object({ type: t.literal('guest') })\n   * )\n   * ```\n   */\n  union<T extends SchemaType[]>(...schemas: T): UnionSchema<T> {\n    return new UnionSchemaImpl(schemas);\n  },\n};\n","import type { SchemaDefinition } from \"@kitojs/types\";\n\n/**\n * Creates a typed schema definition for request validation.\n * This is a type helper that preserves schema structure for type inference.\n *\n * @template T - Schema definition type\n * @param definition - Schema definition object\n * @returns The same schema definition with preserved types\n *\n * @example\n * ```typescript\n * import { schema, t } from 'kitojs';\n *\n * const userSchema = schema({\n *   params: t.object({\n *     id: t.str().uuid()\n *   }),\n *   query: t.object({\n *     limit: t.num().min(1).max(100).default(10)\n *   }),\n *   body: t.object({\n *     name: t.str().min(1),\n *     email: t.str().email()\n *   }),\n *   headers: t.object({\n *     authorization: t.str()\n *   })\n * });\n *\n * app.post('/users/:id', [userSchema], ctx => {\n *   // All request parts are type-safe and validated\n *   const id = ctx.req.params.id; // string (UUID validated)\n *   const limit = ctx.req.query.limit; // number\n *   const name = ctx.req.body.name; // string\n * });\n * ```\n */\nexport function schema<T extends SchemaDefinition>(definition: T): T {\n  return definition;\n}\n","import type { MiddlewareDefinition, MiddlewareHandler } from \"@kitojs/types\";\n\n/**\n * Creates a typed middleware definition.\n *\n * @template TExtensions - Type of context extensions available in the middleware\n * @param handler - Middleware function that processes requests\n * @returns Middleware definition object\n *\n * @example\n * ```typescript\n * import { middleware } from 'kitojs';\n *\n * // Basic middleware\n * const logger = middleware((ctx, next) => {\n *   console.log(`${ctx.req.method} ${ctx.req.url}`);\n *   next();\n * });\n *\n * // Authentication middleware\n * const auth = middleware((ctx, next) => {\n *   const token = ctx.req.headers.authorization;\n *\n *   if (!token || !verifyToken(token)) {\n *     ctx.res.status(401).send('Unauthorized');\n *     return;\n *   }\n *\n *   next();\n * });\n *\n * // Async middleware\n * const asyncAuth = middleware(async (ctx, next) => {\n *   const user = await validateUser(ctx.req.headers.authorization);\n *   if (!user) {\n *     ctx.res.status(401).send('Unauthorized');\n *     return;\n *   }\n *   await next();\n * });\n *\n * // Using middleware\n * app.use(logger); // global\n *\n * // Route middleware\n * app.get('/protected', [auth], ctx => {\n *   ctx.res.send('Secret data');\n * });\n * ```\n */\n// biome-ignore lint/suspicious/noExplicitAny: ...\nexport function middleware<TExtensions = any>(\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  handler: MiddlewareHandler<any, TExtensions>,\n): MiddlewareDefinition {\n  return {\n    type: \"function\",\n    handler: handler as MiddlewareHandler,\n    global: false,\n  };\n}\n","// biome-ignore assist/source/organizeImports: ...\nimport type {\n  CommonHeaderNames,\n  KitoRequest,\n  RequestHeaders,\n} from \"@kitojs/types\";\nimport {\n  getBodyBuffer,\n  getHeader,\n  getAllHeaders,\n  getQueryParam,\n  getAllQuery,\n  getParam,\n  getAllParams,\n  getCookie,\n  getAllCookies,\n  getMethod,\n  getUrl,\n  getPathname,\n  getSearch,\n  getProtocol,\n  getHostname,\n  getIp,\n  getIps,\n  getSecure,\n  getXhr,\n} from \"@kitojs/kito-core\";\n\nexport class RequestBuilder implements KitoRequest {\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private core: any;\n\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  private _body?: Buffer | JSON | {};\n  private _headers?: Record<string, string>;\n  private _query?: Record<string, string | string[]>;\n  private _params?: Record<string, string>;\n  private _cookies?: Record<string, string>;\n  private _method?: string;\n  private _url?: string;\n  private _pathname?: string;\n  private _search?: string | null;\n  private _protocol?: string;\n  private _hostname?: string;\n  private _ip?: string;\n  private _ips?: string[];\n  private _secure?: boolean;\n  private _xhr?: boolean;\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  constructor(requestCore: any) {\n    this.core = requestCore;\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  get body(): any {\n    if (this._body) return this._body;\n\n    const buf = getBodyBuffer(this.core);\n    const type = this.header(\"content-type\") ?? \"\";\n\n    if (type.includes(\"application/json\")) {\n      try {\n        this._body = JSON.parse(buf.toString(\"utf-8\"));\n      } catch {\n        this._body = {};\n      }\n    } else {\n      this._body = buf;\n    }\n\n    return this._body;\n  }\n\n  json<T = unknown>(): T {\n    return JSON.parse(this.body.toString(\"utf-8\"));\n  }\n\n  text(): string {\n    return this.body.toString(\"utf-8\");\n  }\n\n  get headers(): RequestHeaders {\n    if (!this._headers) {\n      this._headers = getAllHeaders(this.core);\n    }\n    return this._headers;\n  }\n\n  header(name: CommonHeaderNames): string | undefined;\n  header(name: string): string | undefined;\n  header(name: string): string | undefined {\n    const value = getHeader(this.core, name.toLowerCase());\n    return value ?? undefined;\n  }\n\n  get query(): Record<string, string | string[]> {\n    if (!this._query) {\n      this._query = getAllQuery(this.core);\n    }\n    return this._query;\n  }\n\n  queryParam(name: string): string | string[] | undefined {\n    const value = getQueryParam(this.core, name);\n    if (!value) return undefined;\n    return value.length === 1 ? value[0] : value;\n  }\n\n  get params(): Record<string, string> {\n    if (!this._params) {\n      this._params = getAllParams(this.core);\n    }\n    return this._params;\n  }\n\n  param(name: string): string | undefined {\n    return getParam(this.core, name) ?? undefined;\n  }\n\n  get cookies(): Record<string, string> {\n    if (!this._cookies) {\n      this._cookies = getAllCookies(this.core);\n    }\n    return this._cookies;\n  }\n\n  cookie(name: string): string | undefined {\n    return getCookie(this.core, name) ?? undefined;\n  }\n\n  get method(): string {\n    if (!this._method) {\n      this._method = getMethod(this.core);\n    }\n    return this._method;\n  }\n\n  get url(): string {\n    if (!this._url) {\n      this._url = getUrl(this.core);\n    }\n    return this._url;\n  }\n\n  get pathname(): string {\n    if (!this._pathname) {\n      this._pathname = getPathname(this.core);\n    }\n    return this._pathname;\n  }\n\n  get search(): string | null {\n    if (this._search === undefined) {\n      this._search = getSearch(this.core) ?? null;\n    }\n    return this._search;\n  }\n\n  get protocol(): string {\n    if (!this._protocol) {\n      this._protocol = getProtocol(this.core);\n    }\n    return this._protocol;\n  }\n\n  get hostname(): string {\n    if (!this._hostname) {\n      this._hostname = getHostname(this.core);\n    }\n    return this._hostname;\n  }\n\n  get ip(): string {\n    if (!this._ip) {\n      this._ip = getIp(this.core);\n    }\n    return this._ip;\n  }\n\n  get ips(): string[] {\n    if (!this._ips) {\n      this._ips = getIps(this.core);\n    }\n    return this._ips;\n  }\n\n  get secure(): boolean {\n    if (this._secure === undefined) {\n      this._secure = getSecure(this.core);\n    }\n    return this._secure;\n  }\n\n  get xhr(): boolean {\n    if (this._xhr === undefined) {\n      this._xhr = getXhr(this.core);\n    }\n    return this._xhr;\n  }\n\n  get originalUrl(): string {\n    return this.url;\n  }\n\n  get raw(): {\n    body: Buffer;\n    headers: RequestHeaders;\n    url: string;\n    method: string;\n  } {\n    return {\n      body: this.body,\n      headers: this.headers,\n      url: this.url,\n      method: this.method,\n    };\n  }\n}\n","// biome-ignore assist/source/organizeImports: ...\nimport type {\n  KitoResponse,\n  CookieOptions,\n  SendFileOptions,\n  CommonResponseHeaderNames,\n} from \"@kitojs/types\";\n\nimport { sendResponse } from \"@kitojs/kito-core\";\nimport { readFileSync } from \"node:fs\";\n\nconst HTTP_STATUS_MESSAGES: Record<number, string> = {\n  100: \"Continue\",\n  101: \"Switching Protocols\",\n  200: \"OK\",\n  201: \"Created\",\n  202: \"Accepted\",\n  204: \"No Content\",\n  301: \"Moved Permanently\",\n  302: \"Found\",\n  304: \"Not Modified\",\n  400: \"Bad Request\",\n  401: \"Unauthorized\",\n  403: \"Forbidden\",\n  404: \"Not Found\",\n  405: \"Method Not Allowed\",\n  500: \"Internal Server Error\",\n  502: \"Bad Gateway\",\n  503: \"Service Unavailable\",\n};\n\ninterface ResponseState {\n  status: number;\n  headers: Map<string, string>;\n  body?: Buffer;\n}\n\nexport class ResponseBuilder implements KitoResponse {\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private channel: any;\n  private state: ResponseState;\n  private finished = false;\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  constructor(responseChannel: any) {\n    this.channel = responseChannel;\n    this.state = {\n      status: 200,\n      headers: new Map(),\n    };\n  }\n\n  private checkFinished(): void {\n    if (this.finished) {\n      throw new Error(\"Response already sent\");\n    }\n  }\n\n  private serializeAndSend(): void {\n    const headersArray = Array.from(this.state.headers.entries());\n    const headersJson = JSON.stringify(headersArray);\n    const headersBytes = Buffer.from(headersJson, \"utf-8\");\n\n    const body = this.state.body || Buffer.alloc(0);\n\n    const totalSize = 2 + 4 + headersBytes.length + body.length;\n    const buffer = Buffer.allocUnsafe(totalSize);\n\n    let offset = 0;\n\n    buffer.writeUInt16LE(this.state.status, offset);\n    offset += 2;\n\n    buffer.writeUInt32LE(headersBytes.length, offset);\n    offset += 4;\n\n    headersBytes.copy(buffer, offset);\n    offset += headersBytes.length;\n\n    if (body.length > 0) {\n      body.copy(buffer, offset);\n    }\n\n    sendResponse(this.channel, buffer);\n    this.finished = true;\n  }\n\n  status(code: number): KitoResponse {\n    this.checkFinished();\n    this.state.status = code;\n    return this;\n  }\n\n  sendStatus(code: number): void {\n    this.checkFinished();\n    const message = HTTP_STATUS_MESSAGES[code] || \"Unknown\";\n    this.state.status = code;\n    this.state.body = Buffer.from(message, \"utf-8\");\n    this.serializeAndSend();\n  }\n\n  header(name: CommonResponseHeaderNames, value: string): KitoResponse;\n  header(name: string, value: string): KitoResponse;\n  header(name: string, value: string): KitoResponse {\n    this.checkFinished();\n\n    this.state.headers.set(name.toLowerCase(), value);\n    return this;\n  }\n\n  headers(headers: Record<CommonResponseHeaderNames, string>): KitoResponse;\n  headers(headers: Record<string, string>): KitoResponse;\n  headers(headers: Record<string, string>): KitoResponse {\n    this.checkFinished();\n\n    for (const [name, value] of Object.entries(headers)) {\n      this.state.headers.set(name.toLowerCase(), value);\n    }\n    return this;\n  }\n\n  append(field: CommonResponseHeaderNames, value: string): KitoResponse;\n  append(field: string, value: string): KitoResponse;\n  append(field: string, value: string): KitoResponse {\n    this.checkFinished();\n\n    const key = field.toLowerCase();\n    const existing = this.state.headers.get(key);\n\n    if (existing) {\n      this.state.headers.set(key, `${existing}, ${value}`);\n    } else {\n      this.state.headers.set(key, value);\n    }\n\n    return this;\n  }\n\n  set(field: CommonResponseHeaderNames, value: string): KitoResponse;\n  set(field: string, value: string): KitoResponse;\n  set(field: string, value: string): KitoResponse {\n    return this.header(field, value);\n  }\n\n  get(field: CommonResponseHeaderNames): string | undefined;\n  get(field: string): string | undefined;\n  get(field: string): string | undefined {\n    return this.state.headers.get(field.toLowerCase());\n  }\n\n  type(contentType: string): KitoResponse {\n    this.checkFinished();\n\n    if (!contentType.includes(\"/\")) {\n      const mimeTypes: Record<string, string> = {\n        html: \"text/html\",\n        json: \"application/json\",\n        xml: \"application/xml\",\n        text: \"text/plain\",\n        txt: \"text/plain\",\n        js: \"application/javascript\",\n        css: \"text/css\",\n        png: \"image/png\",\n        jpg: \"image/jpeg\",\n        jpeg: \"image/jpeg\",\n        gif: \"image/gif\",\n        svg: \"image/svg+xml\",\n        pdf: \"application/pdf\",\n        zip: \"application/zip\",\n      };\n\n      contentType = mimeTypes[contentType] || contentType;\n    }\n\n    return this.header(\"content-type\", contentType);\n  }\n\n  contentType(contentType: string): KitoResponse {\n    return this.type(contentType);\n  }\n\n  cookie(name: string, value: string, options?: CookieOptions): KitoResponse {\n    this.checkFinished();\n\n    const cookie = this.serializeCookie(name, value, options);\n\n    const existing = this.state.headers.get(\"set-cookie\");\n    if (existing) {\n      this.state.headers.set(\"set-cookie\", `${existing}, ${cookie}`);\n    } else {\n      this.state.headers.set(\"set-cookie\", cookie);\n    }\n\n    return this;\n  }\n\n  private serializeCookie(\n    name: string,\n    value: string,\n    options?: CookieOptions,\n  ): string {\n    let cookie = `${name}=${value}`;\n\n    if (options?.maxAge !== undefined) {\n      cookie += `; Max-Age=${options.maxAge}`;\n    }\n\n    if (options?.path) {\n      cookie += `; Path=${options.path}`;\n    } else {\n      cookie += \"; Path=/\";\n    }\n\n    if (options?.domain) {\n      cookie += `; Domain=${options.domain}`;\n    }\n\n    if (options?.httpOnly) {\n      cookie += \"; HttpOnly\";\n    }\n\n    if (options?.secure) {\n      cookie += \"; Secure\";\n    }\n\n    if (options?.sameSite) {\n      const sameSite =\n        typeof options.sameSite === \"string\"\n          ? options.sameSite\n          : options.sameSite\n            ? \"Strict\"\n            : \"Lax\";\n      cookie += `; SameSite=${sameSite}`;\n    }\n\n    return cookie;\n  }\n\n  clearCookie(name: string, options?: CookieOptions): KitoResponse {\n    this.checkFinished();\n\n    const clearOptions = { ...options, maxAge: 0, expires: new Date(0) };\n    return this.cookie(name, \"\", clearOptions);\n  }\n\n  // end methods\n\n  send(data: unknown): void {\n    this.checkFinished();\n    if (Buffer.isBuffer(data)) {\n      this.state.body = data;\n    } else if (typeof data === \"string\") {\n      this.state.body = Buffer.from(data, \"utf-8\");\n    } else {\n      this.state.body = Buffer.from(String(data), \"utf-8\");\n    }\n\n    this.serializeAndSend();\n  }\n\n  json(data: unknown): void {\n    this.checkFinished();\n\n    this.type(\"application/json\");\n    const jsonStr = JSON.stringify(data);\n    this.state.body = Buffer.from(jsonStr, \"utf-8\");\n    this.serializeAndSend();\n  }\n\n  text(data: string): void {\n    this.checkFinished();\n\n    this.type(\"text/plain\");\n    this.state.body = Buffer.from(data, \"utf-8\");\n    this.serializeAndSend();\n  }\n\n  html(data: string): void {\n    this.checkFinished();\n\n    this.type(\"text/html\");\n    this.state.body = Buffer.from(data, \"utf-8\");\n    this.serializeAndSend();\n  }\n\n  redirect(url: string, code?: number): void {\n    this.checkFinished();\n\n    this.state.status = code || 302;\n    this.header(\"location\", url);\n    this.serializeAndSend();\n  }\n\n  location(url: string): KitoResponse {\n    this.checkFinished();\n\n    return this.header(\"location\", url);\n  }\n\n  attachment(filename?: string): KitoResponse {\n    this.checkFinished();\n\n    if (filename) {\n      const encodedFilename = encodeURIComponent(filename);\n      return this.header(\n        \"content-disposition\",\n        `attachment; filename=\"${encodedFilename}\"`,\n      );\n    }\n\n    return this.header(\"content-disposition\", \"attachment\");\n  }\n\n  download(path: string, filename?: string): void {\n    this.checkFinished();\n\n    const name = filename || path.split(\"/\").pop() || \"download\";\n    this.attachment(name);\n\n    try {\n      this.state.body = readFileSync(path);\n      this.serializeAndSend();\n    } catch (_) {\n      this.state.status = 404;\n      this.state.body = Buffer.from(\"File Not Found\", \"utf-8\");\n      this.serializeAndSend();\n    }\n  }\n\n  sendFile(path: string, options?: SendFileOptions): void {\n    this.checkFinished();\n\n    try {\n      const fullPath = options?.root ? `${options.root}/${path}` : path;\n      this.state.body = readFileSync(fullPath);\n\n      const mimeType = this.getMimeType(path);\n      this.type(mimeType);\n\n      if (options?.headers) {\n        this.headers(options.headers);\n      }\n\n      this.serializeAndSend();\n    } catch (_) {\n      this.state.status = 404;\n      this.state.body = Buffer.from(\"File Not Found\", \"utf-8\");\n      this.serializeAndSend();\n    }\n  }\n\n  private getMimeType(path: string): string {\n    const extension = path.split(\".\").pop()?.toLowerCase() || \"\";\n\n    const mimeTypes: Record<string, string> = {\n      html: \"text/html\",\n      htm: \"text/html\",\n      css: \"text/css\",\n      js: \"application/javascript\",\n      mjs: \"application/javascript\",\n      json: \"application/json\",\n      xml: \"application/xml\",\n      txt: \"text/plain\",\n      png: \"image/png\",\n      jpg: \"image/jpeg\",\n      jpeg: \"image/jpeg\",\n      gif: \"image/gif\",\n      svg: \"image/svg+xml\",\n      webp: \"image/webp\",\n      ico: \"image/x-icon\",\n      pdf: \"application/pdf\",\n      zip: \"application/zip\",\n      wasm: \"application/wasm\",\n      mp4: \"video/mp4\",\n      webm: \"video/webm\",\n      mp3: \"audio/mpeg\",\n      wav: \"audio/wav\",\n      woff: \"font/woff2\",\n      woff2: \"font/woff2\",\n      ttf: \"font/ttf\",\n      otf: \"font/otf\",\n    };\n\n    return mimeTypes[extension] || \"application/octet-stream\";\n  }\n\n  vary(field: string): KitoResponse {\n    this.checkFinished();\n\n    return this.append(\"vary\", field);\n  }\n\n  links(links: Record<string, string>): KitoResponse {\n    this.checkFinished();\n\n    const linkHeader = Object.entries(links)\n      .map(([rel, url]) => `<${url}>; rel=\"${rel}\"`)\n      .join(\", \");\n\n    return this.header(\"link\", linkHeader);\n  }\n\n  format(obj: Record<string, () => void>): KitoResponse {\n    this.checkFinished();\n\n    const acceptHeader = this.get(\"accept\") || \"*/*\";\n\n    for (const [type, handler] of Object.entries(obj)) {\n      if (acceptHeader.includes(type) || acceptHeader.includes(\"*/*\")) {\n        handler();\n        return this;\n      }\n    }\n\n    const firstHandler = Object.values(obj)[0];\n    if (firstHandler) {\n      firstHandler();\n    }\n\n    return this;\n  }\n}\n","import * as acorn from \"acorn\";\nimport * as walk from \"acorn-walk\";\n\nexport type StaticResponseType =\n  | { type: \"none\" }\n  | {\n      type: \"full_static\";\n      method: string;\n      status: number;\n      headers: Record<string, string>;\n      body: string;\n    }\n  | {\n      type: \"param_template\";\n      method: string;\n      status: number;\n      headers: Record<string, string>;\n      template: string;\n      params: string[];\n    };\n\ninterface ResponseCall {\n  method: \"send\" | \"json\" | \"text\" | \"html\";\n  arg?: any;\n  usesContext: boolean;\n}\n\nexport function analyzeHandler(handler: Function): StaticResponseType {\n  const source = handler.toString();\n\n  try {\n    const ast = acorn.parse(source, {\n      ecmaVersion: 2022,\n      sourceType: \"module\",\n    }) as any;\n\n    let responseCall: ResponseCall | null = null;\n    let hasLogic = false;\n    \n    const usedParams = new Set<string>();\n    const usedQuery = new Set<string>();\n\n    walk.simple(ast, {\n      CallExpression(node: any) {\n        if (\n          node.callee.type === \"MemberExpression\" &&\n          node.callee.object.type === \"MemberExpression\" &&\n          node.callee.object.property.name === \"res\"\n        ) {\n          const method = node.callee.property.name;\n\n          if ([\"send\", \"json\", \"text\", \"html\"].includes(method)) {\n            if (responseCall !== null) {\n              hasLogic = true;\n              return;\n            }\n\n            const newResponseCall: ResponseCall = {\n              method,\n              arg: node.arguments[0],\n              usesContext: false,\n            };\n\n            walk.simple(node.arguments[0], {\n              MemberExpression(argNode: any) {\n                if (\n                  argNode.object.type === \"Identifier\" &&\n                  argNode.object.name === \"ctx\"\n                ) {\n                  newResponseCall.usesContext = true;\n                }\n              },\n            });\n\n            responseCall = newResponseCall;\n          }\n        }\n      },\n\n      MemberExpression(node: any) {\n        if (\n          node.object.type === \"MemberExpression\" &&\n          node.object.object.type === \"MemberExpression\" &&\n          node.object.object.property.name === \"req\" &&\n          node.object.property.name === \"params\"\n        ) {\n          if (node.property.type === \"Identifier\") {\n            usedParams.add(node.property.name);\n          }\n        }\n\n        if (\n          node.object.type === \"MemberExpression\" &&\n          node.object.object.type === \"MemberExpression\" &&\n          node.object.object.property.name === \"req\" &&\n          node.object.property.name === \"query\"\n        ) {\n          if (node.property.type === \"Identifier\") {\n            usedQuery.add(node.property.name);\n          }\n        }\n      },\n\n      VariableDeclaration() {\n        hasLogic = true;\n      },\n\n      IfStatement() {\n        hasLogic = true;\n      },\n      ForStatement() {\n        hasLogic = true;\n      },\n      WhileStatement() {\n        hasLogic = true;\n      },\n    });\n\n    if (!responseCall) {\n      return { type: \"none\" };\n    }\n\n    const rc = responseCall as ResponseCall;\n\n    if (hasLogic) {\n      return { type: \"none\" };\n    }\n\n    if (!rc.usesContext) {\n      const value = evaluateStaticValue(rc.arg, source);\n      if (value === null) {\n        return { type: \"none\" };\n      }\n\n      const { body, contentType } = serializeResponseValue(rc.method, value);\n\n      return {\n        type: \"full_static\",\n        method: rc.method,\n        status: 200,\n        headers: {\n          \"content-type\": contentType,\n          \"content-length\": body.length.toString(),\n        },\n        body: body.toString(\"base64\"),\n      };\n    }\n\n    if (usedParams.size > 0 || usedQuery.size > 0) {\n      if (rc.method === \"json\" && rc.arg?.type === \"ObjectExpression\") {\n        const template = extractTemplate(rc.arg);\n        return {\n          type: \"param_template\",\n          method: \"json\",\n          status: 200,\n          headers: {\n            \"content-type\": \"application/json\",\n          },\n          template,\n          params: Array.from(usedParams),\n        };\n      }\n    }\n\n    return { type: \"none\" };\n  } catch (error) {\n    console.warn(\"Failed to analyze handler:\", error);\n    return { type: \"none\" };\n  }\n}\n\nfunction evaluateStaticValue(node: any, source: string): any {\n  if (!node) return null;\n\n  try {\n    switch (node.type) {\n      case \"Literal\":\n        return node.value;\n\n      case \"ObjectExpression\":\n        const obj: any = {};\n        for (const prop of node.properties) {\n          if (prop.type === \"Property\" && prop.key.type === \"Identifier\") {\n            const value = evaluateStaticValue(prop.value, source);\n            if (value === null) return null;\n            obj[prop.key.name] = value;\n          }\n        }\n        return obj;\n\n      case \"ArrayExpression\":\n        const arr: any[] = [];\n        for (const element of node.elements) {\n          const value = evaluateStaticValue(element, source);\n          if (value === null) return null;\n          arr.push(value);\n        }\n        return arr;\n\n      case \"TemplateLiteral\":\n        if (node.expressions.length === 0) {\n          return node.quasis[0].value.cooked;\n        }\n        return null;\n\n      default:\n        return null;\n    }\n  } catch {\n    return null;\n  }\n}\n\nfunction serializeResponseValue(\n  method: string,\n  value: any,\n): { body: Buffer; contentType: string } {\n  switch (method) {\n    case \"json\":\n      return {\n        body: Buffer.from(JSON.stringify(value), \"utf-8\"),\n        contentType: \"application/json\",\n      };\n    case \"text\":\n    case \"send\":\n      return {\n        body: Buffer.from(String(value), \"utf-8\"),\n        contentType: \"text/plain\",\n      };\n    case \"html\":\n      return {\n        body: Buffer.from(String(value), \"utf-8\"),\n        contentType: \"text/html\",\n      };\n    default:\n      return {\n        body: Buffer.from(String(value), \"utf-8\"),\n        contentType: \"text/plain\",\n      };\n  }\n}\n\nfunction extractTemplate(node: any): string {\n  const parts: string[] = [];\n\n  function processNode(n: any): string {\n    if (n.type === \"Literal\") return JSON.stringify(n.value);\n    if (\n      n.type === \"MemberExpression\" &&\n      n.object.type === \"MemberExpression\" &&\n      n.object.object.type === \"MemberExpression\" &&\n      n.object.object.property.name === \"req\"\n    ) {\n      const source = n.object.property.name;\n      const key = n.property.name;\n      return `\"{{${source}.${key}}}\"`;\n    }\n    return \"null\";\n  }\n\n  const props = node.properties.map((prop: any) => {\n    const key = prop.key.name;\n    const value = processNode(prop.value);\n    return `\"${key}\":${value}`;\n  });\n\n  return `{${props.join(\",\")}}`;\n}\n","// biome-ignore assist/source/organizeImports: ...\nimport type {\n  HttpMethod,\n  MiddlewareDefinition,\n  SchemaDefinition,\n  ServerOptions,\n  RouteHandler,\n  MiddlewareHandler,\n  KitoContext,\n  RouteChain,\n  KitoServerInstance,\n} from \"@kitojs/types\";\n\nimport { ServerCore, type ServerOptionsCore } from \"@kitojs/kito-core\";\nimport { RequestBuilder } from \"./request\";\nimport { ResponseBuilder } from \"./response\";\n\nimport { analyzeHandler, type StaticResponseType } from \"./analyzer\";\n\n/**\n * Main server class for Kito framework.\n * Provides HTTP routing, middleware support, and context extensions.\n *\n * @template TExtensions - Type of custom extensions added to the context\n *\n * @example\n * ```typescript\n * const app = new KitoServer();\n *\n * app.get('/', ctx => {\n *   ctx.res.send('Hello World!');\n * });\n *\n * app.listen(3000);\n * ```\n */\n// biome-ignore lint/complexity/noBannedTypes: ...\nexport class KitoServer<TExtensions = {}>\n  implements KitoServerInstance<TExtensions>\n{\n  private globalMiddlewares: MiddlewareDefinition[] = [];\n  private serverOptions: ServerOptions = {};\n\n  private coreServer: ServerCore;\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private extensionFn?: (ctx: any) => void;\n\n  /**\n   * Creates a new Kito server instance.\n   *\n   * @param options - Server configuration options\n   * @param options.port - Port to listen on (default: 3000)\n   * @param options.host - Host to bind to (default: \"0.0.0.0\")\n   * @param options.trustProxy - Trust X-Forwarded-* headers\n   * @param options.maxRequestSize - Maximum request body size in bytes\n   * @param options.timeout - Request timeout in milliseconds\n   */\n  constructor(options?: ServerOptions) {\n    this.serverOptions = { ...this.serverOptions, ...options };\n    this.coreServer = new ServerCore({\n      port: 3000,\n      host: \"0.0.0.0\",\n      ...options,\n    });\n  }\n\n  /**\n   * Extends the request context with custom properties or methods.\n   *\n   * @template TNewExtensions - Type of the new extensions\n   * @param fn - Function that adds extensions to the context\n   * @returns A new server instance with extended context type\n   *\n   * @example\n   * ```typescript\n   * interface Database {\n   *   query: (sql: string) => Promise<any>;\n   * }\n   *\n   * const app = server().extend<{ db: Database }>(ctx => {\n   *   ctx.db = createDatabase();\n   * });\n   *\n   * app.get('/users', ctx => {\n   *   const users = await ctx.db.query('SELECT * FROM users');\n   *   ctx.res.json(users);\n   * });\n   * ```\n   */\n  extend<TNewExtensions = unknown>(\n    fn: (\n      ctx: KitoContext & TExtensions & Partial<TNewExtensions>,\n      // biome-ignore lint/suspicious/noConfusingVoidType: ...\n    ) => TNewExtensions | void,\n  ): KitoServer<TExtensions & TNewExtensions> {\n    const newServer = new KitoServer<TExtensions & TNewExtensions>(\n      this.serverOptions,\n    );\n\n    newServer.globalMiddlewares = [...this.globalMiddlewares];\n\n    newServer.coreServer = this.coreServer;\n\n    const previousExtensionFn = this.extensionFn;\n    // biome-ignore lint/suspicious/noExplicitAny: ...\n    newServer.extensionFn = (ctx: any) => {\n      if (previousExtensionFn) {\n        previousExtensionFn(ctx);\n      }\n\n      const result = fn(ctx);\n      if (result && typeof result === \"object\") {\n        Object.assign(ctx, result);\n      }\n    };\n\n    return newServer;\n  }\n\n  /**\n   * Registers a global middleware that runs for all routes.\n   *\n   * @param middleware - Middleware function or definition\n   * @returns The server instance for chaining\n   *\n   * @example\n   * ```typescript\n   * app.use((ctx, next) => {\n   *   console.log(`${ctx.req.method} ${ctx.req.url}`);\n   *   next();\n   * });\n   * ```\n   */\n  use(\n    middleware: MiddlewareDefinition | MiddlewareHandler,\n  ): KitoServer<TExtensions> {\n    if (typeof middleware === \"function\") {\n      this.globalMiddlewares.push({\n        type: \"function\",\n        handler: middleware,\n        global: true,\n      });\n    } else {\n      this.globalMiddlewares.push({ ...middleware, global: true });\n    }\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers a GET route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path (supports :params)\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   *\n   * @example\n   * ```typescript\n   * app.get('/users/:id', ctx => {\n   *   ctx.res.json({ id: ctx.req.params.id });\n   * });\n   * ```\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  get<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  /**\n   * Registers a GET route with middlewares and/or schema validation.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param middlewares - Array of middlewares and/or schema definition\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  get<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  get<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"GET\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers a POST route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  post<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  post<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  post<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"POST\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers a PUT route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  put<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  put<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  put<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"PUT\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers a DELETE route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  delete<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  delete<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  delete<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"DELETE\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers a PATCH route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  patch<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  patch<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  patch<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"PATCH\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers a HEAD route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  head<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  head<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  head<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"HEAD\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Registers an OPTIONS route.\n   *\n   * @template TSchema - Request schema type\n   * @param path - Route path\n   * @param handler - Route handler function\n   * @returns The server instance for chaining\n   */\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  options<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  options<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewares: (MiddlewareDefinition | TSchema)[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions>;\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  options<TSchema extends SchemaDefinition = {}>(\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): KitoServer<TExtensions> {\n    this.addRoute<TSchema>(\"OPTIONS\", path, middlewaresOrHandler, handler);\n\n    return this as KitoServer<TExtensions>;\n  }\n\n  /**\n   * Creates a route builder for chaining multiple HTTP methods on the same path.\n   *\n   * @param path - Base path for all routes in the chain\n   * @returns Route chain builder\n   *\n   * @example\n   * ```typescript\n   * app.route('/api/users')\n   *   .get(ctx => ctx.res.json(users))\n   *   .post(ctx => ctx.res.json({ created: true }))\n   *   .end();\n   * ```\n   */\n  route(path: string): RouteChain<TExtensions> {\n    const self = this;\n\n    const chain: RouteChain<TExtensions> = {\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      get<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"GET\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      post<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"POST\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      put<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"PUT\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      delete<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"DELETE\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      patch<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"PATCH\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      options<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"OPTIONS\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      // biome-ignore lint/complexity/noBannedTypes: ...\n      head<TSchema extends SchemaDefinition = {}>(\n        middlewaresOrHandler:\n          | (MiddlewareDefinition | TSchema)[]\n          | RouteHandler<TSchema, TExtensions>,\n        handler?: RouteHandler<TSchema, TExtensions>,\n      ): RouteChain<TExtensions> {\n        self.addRoute(\"HEAD\", path, middlewaresOrHandler, handler);\n        return chain;\n      },\n\n      end(): KitoServer<TExtensions> {\n        return self;\n      },\n    };\n\n    return chain;\n  }\n\n  // biome-ignore lint/complexity/noBannedTypes: ...\n  private addRoute<TSchema extends SchemaDefinition = {}>(\n    method: HttpMethod,\n    path: string,\n    middlewaresOrHandler:\n      | (MiddlewareDefinition | TSchema)[]\n      | RouteHandler<TSchema, TExtensions>,\n    handler?: RouteHandler<TSchema, TExtensions>,\n  ): void {\n    let finalHandler: RouteHandler<TSchema, TExtensions>;\n    let middlewares: (MiddlewareDefinition | TSchema)[] = [];\n\n    if (typeof middlewaresOrHandler === \"function\") {\n      finalHandler = middlewaresOrHandler as RouteHandler<TSchema, TExtensions>;\n    } else {\n      middlewares = middlewaresOrHandler as (MiddlewareDefinition | TSchema)[];\n      // biome-ignore lint/style/noNonNullAssertion: ...\n      finalHandler = handler!;\n    }\n\n    const routeMiddlewares: MiddlewareDefinition[] = [];\n    let routeSchema: TSchema | undefined;\n\n    for (const item of middlewares) {\n      if (this.isSchemaDefinition(item)) {\n        routeSchema = item as TSchema;\n        routeMiddlewares.push({\n          type: \"schema\",\n          // biome-ignore lint/suspicious/noExplicitAny: ...\n          schema: item as any,\n          global: false,\n        });\n      } else {\n        routeMiddlewares.push({\n          ...(item as MiddlewareDefinition),\n          global: false,\n        });\n      }\n    }\n\n    let staticResponse: StaticResponseType = { type: \"none\" };\n\n    if (this.globalMiddlewares.length === 0 && routeMiddlewares.length === 0) {\n      staticResponse = analyzeHandler(finalHandler);\n    }\n\n    const fusedHandler = this.fuseMiddlewares(\n      this.globalMiddlewares,\n      routeMiddlewares,\n      finalHandler,\n    );\n\n    const routeHandler = async (ctx: KitoContext<TSchema>) => {\n      const reqBuilder = new RequestBuilder(ctx.req);\n      const resBuilder = new ResponseBuilder(ctx.res);\n\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      const context: any = { req: reqBuilder, res: resBuilder };\n\n      if (this.extensionFn) {\n        this.extensionFn(context);\n      }\n\n      await fusedHandler(context);\n    };\n\n    const schemaJson = routeSchema\n      ? this.serializeSchema(routeSchema)\n      : undefined;\n\n    const staticResponseJson =\n      staticResponse.type !== \"none\"\n        ? JSON.stringify(staticResponse)\n        : undefined;\n\n    this.coreServer.addRoute({\n      method,\n      path,\n      handler: routeHandler,\n      schema: schemaJson,\n      staticResponse: staticResponseJson,\n    });\n  }\n\n  private serializeSchema(schema: SchemaDefinition): string {\n    // biome-ignore lint/suspicious/noExplicitAny: ...\n    const serialized: any = {};\n\n    if (schema.params) {\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      serialized.params = (schema.params as any)._serialize();\n    }\n    if (schema.query) {\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      serialized.query = (schema.query as any)._serialize();\n    }\n    if (schema.body) {\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      serialized.body = (schema.body as any)._serialize();\n    }\n    if (schema.headers) {\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      serialized.headers = (schema.headers as any)._serialize();\n    }\n\n    return JSON.stringify(serialized);\n  }\n\n  private fuseMiddlewares<TSchema extends SchemaDefinition>(\n    globals: MiddlewareDefinition[],\n    routeMiddlewares: MiddlewareDefinition[],\n    handler: RouteHandler<TSchema, TExtensions>,\n  ): RouteHandler<TSchema, TExtensions> {\n    const functions = [\n      ...globals\n        .filter((m) => m.type === \"function\" && m.handler)\n        // biome-ignore lint/style/noNonNullAssertion: ...\n        .map((m) => m.handler!),\n      ...routeMiddlewares\n        .filter((m) => m.type === \"function\" && m.handler)\n        // biome-ignore lint/style/noNonNullAssertion: ...\n        .map((m) => m.handler!),\n    ];\n\n    if (functions.length === 0)\n      return handler as RouteHandler<TSchema, TExtensions>;\n\n    // biome-ignore lint/suspicious/noExplicitAny: ...\n    return async (ctx: any) => {\n      let i = 0;\n      // biome-ignore lint/suspicious/noExplicitAny: ...\n      const next = async (): Promise<any> => {\n        if (i < functions.length) {\n          const fn = functions[i++];\n          return fn(ctx, next);\n        } else {\n          return handler(ctx);\n        }\n      };\n      return next();\n    };\n  }\n\n  // biome-ignore lint/suspicious/noExplicitAny: ...\n  private isSchemaDefinition(item: any): item is SchemaDefinition {\n    return item && (item.params || item.query || item.body || item.headers);\n  }\n\n  /**\n   * Starts the HTTP server and begins listening for requests.\n   *\n   * @param portOrCallback - Port number or ready callback\n   * @param hostOrCallback - Host string or ready callback\n   * @param maybeCallback - Ready callback\n   * @returns Promise resolving to server configuration\n   *\n   * @example\n   * ```typescript\n   * // Empty\n   * await app.listen();\n   *\n   * // Simple\n   * await app.listen(3000);\n   *\n   * // With callback\n   * await app.listen(3000, () => {\n   *   console.log('Server ready!');\n   * });\n   *\n   * // With port and host\n   * await app.listen(3000, '127.0.0.1', () => {\n   *   console.log('Server ready on 127.0.0.1:3000');\n   * });\n   * ```\n   */\n  async listen(\n    portOrCallback?: number | (() => void),\n    hostOrCallback?: string | (() => void),\n    maybeCallback?: () => void,\n  ): Promise<ServerOptionsCore> {\n    let port: number | undefined;\n    let host: string | undefined;\n    let ready: (() => void) | undefined;\n\n    if (typeof portOrCallback === \"function\") {\n      ready = portOrCallback;\n    } else {\n      port = portOrCallback;\n      if (typeof hostOrCallback === \"function\") {\n        ready = hostOrCallback;\n      } else {\n        host = hostOrCallback;\n        ready = maybeCallback;\n      }\n    }\n\n    const finalPort = port ?? this.serverOptions.port ?? 3000;\n    const finalHost = host ?? this.serverOptions.host ?? \"0.0.0.0\";\n\n    const configuration: ServerOptionsCore = {\n      port: finalPort,\n      host: finalHost,\n      ...this.serverOptions,\n    };\n\n    this.coreServer.setConfig(configuration);\n    await this.coreServer.start(ready);\n\n    return configuration;\n  }\n\n  /**\n   * Closes the server and stops accepting new connections.\n   */\n  close(): void {\n    this.coreServer.close();\n  }\n}\n\n/**\n * Creates a new Kito server instance.\n *\n * @param options - Server configuration options\n * @returns New server instance\n *\n * @example\n * ```typescript\n * import { server } from 'kitojs';\n *\n * const app = server();\n *\n * app.get('/', ctx => {\n *   ctx.res.send('Hello World!');\n * });\n *\n * app.listen(3000);\n * ```\n */\n// biome-ignore lint/complexity/noBannedTypes: ...\nexport function server(options?: ServerOptions): KitoServer<{}> {\n  return new KitoServer(options);\n}\n"],"mappings":"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"}